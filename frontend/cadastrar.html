<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/style.css" media="screen" />
    <title>Cadastrar usuário</title>
</head>
<body>
    <header>
        <h1 id=titulo >Criar perfil de Usuário</h1>
    </header>

    <form id="cadastroForm" enctype="multipart/form-data">

        <label for="nome"> <h2 id="subtitulo2" class="nome">Nome completo</h2></label><br>
    <input type="text" id="nome_completo" name="nome_completo" class="nome" placeholder="Digite seu nome completo" required><br>


    <label for="idade"><h2 id="subtitulo2" class="idade">Idade</h2></label><br>
    <input type="number" id="idade" name="idade" class="idade1" placeholder="Digite sua idade" required><br>

    <h2 id="subtitulo2">Endereço</h2>
   
    <label for="rua"> <h3 id="subtitulo2" class="rua">Rua</h3></label><br>
    <input type="text" id="rua" name="rua" class="rua" placeholder="Digite sua rua" required><br>
   
   <label for="bairro"> <h3 id="subtitulo2" class="bairro">Bairro</h3></label><br>
    <input type="text" id="bairro" name="bairro" class="bairro" placeholder="Digite seu bairro" required><br>
    <h3 id="subtitulo2" class="estado">Estado</h3>
    <select id="estado" name="estado" class="estado" required>
        <option value="AC">AC</option>
        <option value="AL">AL</option>
        <option value="AP">AP</option>
        <option value="AM">AM</option>
        <option value="BA">BA</option>
        <option value="CE">CE</option>
        <option value="DF">DF</option>
        <option value="ES">ES</option>
        <option value="GO">GO</option>
        <option value="MA">MA</option>
        <option value="MT">MT</option>
        <option value="MS">MS</option>
        <option value="MG">MG</option>
        <option value="PA">PA</option>
        <option value="PB">PB</option>
        <option value="PR">PR</option>
        <option value="PE">PE</option>
        <option value="PI">PI</option>
        <option value="RJ">RJ</option>
        <option value="RN">RN</option>
        <option value="RS">RS</option>
        <option value="RO">RO</option>
        <option value="RR">RR</option>
        <option value="SC">SC</option>
        <option value="SP">SP</option>
        <option value="SE">SE</option>
        <option value="TO">TO</option>
    </select>
   <br>

    
    <label for="bio"><h3 id="subtitulo2">Biografia</h3></label><br>
    <textarea id="biografia" name="biografia" class="biografia" placeholder="Digite uma biografia..."></textarea><br>

    <label for="foto"><h3 id="subtitulo2" class="foto">Foto de perfil</h3></label><br>
    <input type="file" id="foto_perfil_files" name="foto_perfil_file" class="foto" accept="image/*"><br>
    <br>

    <label for="senha"><h2 id="subtitulo2">Senha</h2></label>
    <input type="password" id="senha" name="senha" placeholder="Digite uma senha" required><br>
    <br>

    <button type="submit" class="salvar">Cadastrar</button>
    </form>

    <p>Já tem uma conta? <a href='login.html'>Faça login</a></p>

    <div id="mensagem"></div>

    <script>
   document.getElementById('cadastroForm').addEventListener('submit', async function(event) {
            event.preventDefault(); 

            const form = event.target;
            const formData = new FormData(form); 

            const mensagemDiv = document.getElementById('mensagem');
            mensagemDiv.textContent = 'Enviando...';
            mensagemDiv.style.color = 'blue';

            try {
                const response = await fetch('https://perfildeusuario-e5k2.onrender.com/usuarios', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                console.log('Resultado do cadastro:', result);

                if (response.ok && result.id) { 
                    mensagemDiv.textContent = result.message;
                    mensagemDiv.style.color = 'green';
                    form.reset(); 
                    localStorage.setItem('usuarioId', result.id); 
                    window.location.href = 'perfil.html';

                
                } else {
                    mensagemDiv.textContent = `Erro: ${result.message || 'Ocorreu um erro desconhecido.'}`;
                    mensagemDiv.style.color = 'red';
                    console.error('Erro do servidor:', result.error);
                }

            } catch (error) {
                console.error('Erro de rede ou na requisição:', error);
                mensagemDiv.textContent = 'Não foi possível conectar ao servidor. Verifique se o back-end está rodando.';
                mensagemDiv.style.color = 'red';
            }
        });
</script>


</body>
</html>